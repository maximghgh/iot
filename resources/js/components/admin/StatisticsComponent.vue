<template>
    <div>
        <div class="block__info">
            <a class="span__sctrelca" href="#" @click.prevent="goBack">ü†î</a>
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—á–µ–Ω–∏–∫–∞–º</h2>
        </div>
        <table class="light-push-table">
            <thead>
                <tr>
                    <th>–ò–º—è —É—á–µ–Ω–∏–∫–∞</th>
                    <th>–ü—Ä–æ–≥—Ä–µ—Å—Å (%)</th>
                    <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="user in stats" :key="user.id">
                    <td>{{ user.name }}</td>
                    <!-- –û–∫—Ä—É–≥–ª–∏–º –ø—Ä–æ–≥—Ä–µ—Å—Å -->
                    <td>{{ Math.round(user.progress_percent) }}%</td>
                    <td v-if="user.last_completed_at">
                        {{ new Date(user.last_completed_at).toLocaleString() }}
                    </td>
                    <td v-else>‚Äî</td>
                </tr>
            </tbody>
        </table>
    </div>
</template>

<script setup>
import { ref, onMounted } from "vue";

const stats = ref([]);

onMounted(async () => {
    try {
        // –ú–µ–Ω—è–µ–º URL, –µ—Å–ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
        const response = await fetch("/api/chapters/stats");
        stats.value = await response.json();
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", error);
    }
});
function goBack() {
  window.history.back();
}
</script>

<style scoped>
.block__info{
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 30px 0 40px;
}
.span__sctrelca{
    cursor: pointer;
    user-select: none;
    color: #ffffff;
    background-color: #007bff59;
    padding: 2px 7px;
    border-radius: 25px;
    position: absolute;
    top: 50%;
    left: 25%;
    transform: translateY(-50%);
    display: block;
    font-size: 48px;
    list-style: none;
    text-decoration: none;
}
table.light-push-table {
    margin: 0 auto;
    width: 1000px;
    border-collapse: collapse;
    background-color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
}

.light-push-table th,
.light-push-table td {
    padding: 12px 16px;
    border-bottom: 1px solid #e0e0e0;
    text-align: left;
    font-size: 14px;
    white-space: nowrap;
    /* –ó–∞–ø—Ä–µ—â–∞–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç–∞ */
    text-overflow: ellipsis;
    /* –î–æ–±–∞–≤–ª—è–µ—Ç –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ –ø—Ä–∏ –æ–±—Ä–µ–∑–∫–µ */
}

.light-push-table th {
    text-align: center;
    background-color: #f0f8ff;
    /* –ù–µ–∂–Ω–æ-–≥–æ–ª—É–±–æ–π —Ü–≤–µ—Ç */
    font-size: 17px;
    font-weight: 600;
    border-right: 1px solid #d0d0d0;
    padding: 14px;
}

.light-push-table td {
    border-right: 1px solid #f0f0f0;
}

.light-push-table tbody tr:last-child td {
    border-bottom: none;
}

/* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
.light-push-table td.number-cell {
    text-align: center;
    font-weight: bold;
    font-size: 15px;
    width: 120px;
    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –Ω–æ–º–µ—Ä–∞ */
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
@keyframes rowHover {
    from {
        background-color: #ffffff;
        transform: scale(1);
    }

    to {
        background-color: #e0f7fa;
        transform: scale(1.02);
    }
}

.light-push-table tbody tr:hover {
    animation: rowHover 0.3s ease forwards;
}

/* –£–±–∏—Ä–∞–µ–º —Ä–∞–º–∫—É —Å–ø—Ä–∞–≤–∞ —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ */
.light-push-table th:last-child,
.light-push-table td:last-child {
    border-right: none;
}
</style>
